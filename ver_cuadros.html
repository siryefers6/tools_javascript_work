<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Ver Cuadros</title>

    <script src="dexie.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="bg-gray-100">
    <div class="flex justify-center my-6">
      <a
        href="index.html"
        class="bg-gray-600 text-white px-5 py-3 rounded-lg hover:bg-gray-700 shadow-md"
      >
        ← Volver a la Página Principal
      </a>
    </div>

    <div class="max-w-7xl mx-auto p-6 bg-white rounded-lg shadow-lg">
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold">Cuadros Registrados</h1>
        <button
          type="button"
          hx-on="click: mostrarCuadros()"
          class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300"
        >
          Actualizar
        </button>
      </div>

      <div class="overflow-x-auto">
        <table id="tablaCuadros" class="min-w-full border">
          <thead class="bg-gray-200">
            <tr>
              <th class="p-2 border">ID</th>
              <th class="p-2 border">Titulo</th>
              <th class="p-2 border">Cliente</th>
              <th class="p-2 border">Tamano</th>
              <th class="p-2 border">Categoria</th>
              <th class="p-2 border">Valor Final</th>
              <th class="p-2 border">Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <script>
      const db = new Dexie("GaleriaDB");
      db.version(1).stores({
        cuadros:
          "++id,nombres,apellidos,whatsapp,titulo,tamanio,categoria,fecha_inicio,valor_final,updatedAt",
      });

      async function mostrarCuadros() {
        const cuadros = await db.cuadros.orderBy("updatedAt").reverse().toArray();
        const tbody = document.querySelector("#tablaCuadros tbody");
        tbody.innerHTML = "";

        cuadros.forEach((c) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="p-2 border">${c.id}</td>
            <td class="p-2 border">${c.titulo || ""}</td>
            <td class="p-2 border">${c.nombres || ""} ${c.apellidos || ""}</td>
            <td class="p-2 border">${c.tamanio || ""}</td>
            <td class="p-2 border">${c.categoria || ""}</td>
            <td class="p-2 border">${c.valor_final ?? ""}</td>
            <td class="p-2 border text-center">
              <button
                class="bg-yellow-500 text-white px-3 py-1 rounded mr-2"
                data-id="${c.id}"
              >Editar</button>
              <button
                class="bg-red-600 text-white px-3 py-1 rounded"
                data-id="${c.id}"
              >Eliminar</button>
            </td>
          `;
          tr.querySelector("button.bg-yellow-500").addEventListener(
            "click",
            () => editarCuadro(c.id),
          );
          tr.querySelector("button.bg-red-600").addEventListener("click", () =>
            eliminarCuadro(c.id),
          );
          tbody.appendChild(tr);
        });

        if (!cuadros.length) {
          const tr = document.createElement("tr");
          tr.innerHTML =
            '<td colspan="7" class="p-4 text-center text-gray-500">Sin registros</td>';
          tbody.appendChild(tr);
        }
      }

      function editarCuadro(id) {
        window.location.href = `registrar_cuadro.html?id=${id}`;
      }

      async function eliminarCuadro(id) {
        const confirmar = confirm("Eliminar este cuadro?");
        if (!confirmar) return;
        await db.cuadros.delete(id);
        mostrarCuadros();
      }

      mostrarCuadros();
    </script>
  </body>
</html>
